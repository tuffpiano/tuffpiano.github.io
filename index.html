<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Dark Cartoon 3D Piano â€¢ Keyboard Mapped</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: #0d0d0d;
    font-family: Arial, Helvetica, sans-serif;
    overflow: hidden;
    color: #ddd;
  }

  h1 {
    text-align: center;
    margin: 12px 0 4px;
    font-size: 2.2rem;
    text-shadow: 0 0 20px #6600aa, 0 0 40px #440088;
    letter-spacing: 1px;
  }

  .scene {
    perspective: 1300px;
    width: 100%;
    height: 84vh;
    position: relative;
    transform-style: preserve-3d;
  }

  .piano-container {
    position: absolute;
    top: 48%;
    left: 50%;
    transform: translate(-50%, -50%) rotateX(15deg) rotateY(2deg);
    transform-style: preserve-3d;
    width: 1180px;          /* wider for 35 keys */
    height: 360px;
  }

  .piano-body {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(#1a1a1a, #0a0a0a);
    border-radius: 32px;
    box-shadow: 
      0 40px 100px #000000ee,
      inset 0 12px 40px #222222,
      inset 0 -20px 50px #000000cc;
    border: 10px solid #222;
  }

  .keys-wrapper {
    position: absolute;
    bottom: 40px;
    left: 18px;
    right: 18px;
    height: 200px;
    display: flex;
    gap: 3px;
    transform: translateZ(22px);
  }

  .key {
    position: relative;
    flex: 1;
    background: #111;
    border: 1px solid #222;
    border-radius: 0 0 14px 14px;
    box-shadow: 
      inset 0 -10px 18px #000,
      0 14px 35px #00000088,
      0 6px 16px #00000055;
    transition: all 0.09s ease;
    cursor: pointer;
    user-select: none;
  }

  .key.white {
    background: linear-gradient(#222, #111);
  }

  .key.black {
    width: 42px;
    height: 124px;
    background: linear-gradient(#000, #111);
    margin: 0 -21px;
    z-index: 2;
    border-radius: 0 0 12px 12px;
    box-shadow: 
      inset 0 -8px 14px #000,
      0 18px 40px #000000bb,
      6px 0 16px #000 inset;
  }

  .key.pressed {
    transform: translateY(14px) translateZ(10px);
    box-shadow: 
      0 6px 18px #aa00ff66,
      inset 0 -6px 12px #6600aa44;
    background: linear-gradient(to bottom, #440066, #220033) !important;
  }

  .black.pressed {
    transform: translateY(10px) translateZ(12px);
    background: linear-gradient(#8800ff, #440088) !important;
    box-shadow: 0 8px 25px #aa44ffaa;
  }

  /* Hands â€“ raised above keys, no fingers */
  .hands {
    position: absolute;
    bottom: 180px;           /* higher to avoid going under keys */
    left: 50%;
    transform: translateX(-50%);
    width: 960px;
    height: 220px;
    pointer-events: none;
    z-index: 10;
  }

  .hand {
    position: absolute;
    width: 240px;
    height: 220px;
    background: linear-gradient(135deg, #ffdbac, #ffb380);
    border-radius: 110px 110px 60px 60px;
    box-shadow: 
      0 25px 60px #00000099,
      inset 0 12px 35px #ffffff66;
    transform-origin: bottom center;
  }

  .hand.left  { left: -120px; transform: rotate(-20deg); }
  .hand.right { right: -120px; transform: rotate(20deg); }

  .label {
    position: absolute;
    top: -34px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.9rem;
    color: #ddbbff;
    text-shadow: 0 0 14px #9966ff;
    pointer-events: none;
    opacity: 0.8;
  }

  .octave-label {
    position: absolute;
    top: -52px;
    font-size: 1.2rem;
    color: #bb88ff;
    text-shadow: 0 0 18px #7744ff;
  }
</style>
</head>
<body>

<h1>ðŸŒ‘ Dark Cartoon Piano â€“ Full Keyboard Mapping ðŸŒ‘</h1>

<div class="scene">
  <div class="piano-container">
    <div class="piano-body"></div>

    <div class="keys-wrapper" id="keys"></div>

    <div class="hands">
      <div class="hand left" id="handLeft"></div>
      <div class="hand right" id="handRight"></div>
    </div>
  </div>
</div>

<script>
// Note frequencies (A4 = 440 Hz) - from C3 to ~C6 range
const noteFreq = {
  "C3":  130.81, "C#3": 138.59, "D3":  146.83, "D#3": 155.56, "E3":  164.81,
  "F3":  174.61, "F#3": 185.00, "G3":  196.00, "G#3": 207.65, "A3":  220.00,
  "A#3": 233.08, "B3":  246.94,
  "C4":  261.63, "C#4": 277.18, "D4":  293.66, "D#4": 311.13, "E4":  329.63,
  "F4":  349.23, "F#4": 369.99, "G4":  392.00, "G#4": 415.30, "A4":  440.00,
  "A#4": 466.16, "B4":  493.88,
  "C5":  523.25, "C#5": 554.37, "D5":  587.33, "D#5": 622.25, "E5":  659.25,
  "F5":  698.46, "F#5": 739.99, "G5":  783.99, "G#5": 830.61, "A5":  880.00,
  "A#5": 932.33, "B5":  987.77, "C6": 1046.50
};

const keyOrder = "1234567890qwertzuiopasdfghjklyxcvbnm".split("");
const NOTES = [];

// Assign notes sequentially from C3 upwards (35 keys â‰ˆ 2.9 octaves)
const startNote = 48; // MIDI 48 = C3
keyOrder.forEach((k, i) => {
  const midi = startNote + i;
  const freq = 440 * Math.pow(2, (midi - 69) / 12);
  const octave = Math.floor(midi / 12) - 1;
  const noteNames = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  const note = noteNames[midi % 12] + octave;
  NOTES.push({
    note: note,
    key: k.toLowerCase(),
    isBlack: note.includes("#"),
    freq: freq
  });
});

const keyMap = {};
NOTES.forEach(n => keyMap[n.key] = n);

const piano = document.getElementById("keys");
const handL = document.getElementById("handLeft");
const handR = document.getElementById("handRight");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

NOTES.forEach((item) => {
  const k = document.createElement("div");
  k.className = "key " + (item.isBlack ? "black" : "white");
  k.dataset.note = item.note;

  if (!item.isBlack) {
    const lbl = document.createElement("div");
    lbl.className = "label";
    lbl.textContent = item.note;
    k.appendChild(lbl);

    if (item.note === "C3" || item.note === "C4" || item.note === "C5") {
      const oct = document.createElement("div");
      oct.className = "octave-label";
      oct.textContent = item.note;
      k.appendChild(oct);
    }
  }

  piano.appendChild(k);
});

// Better piano-like sound: multiple oscillators + noise + envelope
function playNote(freq) {
  if (!freq) return;

  const now = audioCtx.currentTime;

  // Main tone - sawtooth + triangle mix
  const osc1 = audioCtx.createOscillator();
  osc1.type = "sawtooth";
  osc1.frequency.value = freq;

  const osc2 = audioCtx.createOscillator();
  osc2.type = "triangle";
  osc2.frequency.value = freq;

  // Slight detune for richness
  osc2.detune.value = 3;

  // Hammer / attack noise
  const noise = audioCtx.createBufferSource();
  const bufferSize = audioCtx.sampleRate * 0.02; // 20ms noise burst
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i = 0; i < bufferSize; i++) {
    data[i] = Math.random() * 2 - 1;
  }
  noise.buffer = buffer;

  // Gain nodes
  const gain1 = audioCtx.createGain();
  const gain2 = audioCtx.createGain();
  const noiseGain = audioCtx.createGain();

  // Envelope
  gain1.gain.setValueAtTime(0, now);
  gain1.gain.linearRampToValueAtTime(0.5, now + 0.008);   // fast attack
  gain1.gain.exponentialRampToValueAtTime(0.001, now + 1.8); // decay

  gain2.gain.setValueAtTime(0, now);
  gain2.gain.linearRampToValueAtTime(0.3, now + 0.01);
  gain2.gain.exponentialRampToValueAtTime(0.001, now + 2.0);

  noiseGain.gain.setValueAtTime(0.15, now);
  noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.08); // short noise burst

  // Connect
  osc1.connect(gain1);
  osc2.connect(gain2);
  noise.connect(noiseGain);

  gain1.connect(audioCtx.destination);
  gain2.connect(audioCtx.destination);
  noiseGain.connect(audioCtx.destination);

  osc1.start(now);
  osc2.start(now);
  noise.start(now);
  osc1.stop(now + 2);
  osc2.stop(now + 2.2);
  noise.stop(now + 0.1);
}

function moveHand(hand, relX) {
  const current = parseFloat(hand.style.left || "0");
  const target = relX - 590; // center adjustment for wider piano
  hand.style.transition = "left 0.18s ease-out, transform 0.14s";
  hand.style.left = (current + (target - current) * 0.65) + "px";
  hand.style.transform = `rotate(${20 + (target - current)*0.09}deg) scale(1.05, 0.95)`;
  setTimeout(() => {
    hand.style.transform = `rotate(${20 + (target - current)*0.04}deg) scale(1,1)`;
  }, 140);
}

window.addEventListener("keydown", e => {
  if (e.repeat) return;
  const k = e.key.toLowerCase();
  const info = keyMap[k];
  if (!info) return;

  const keyEl = document.querySelector(`.key[data-note="${info.note}"]`);
  if (!keyEl) return;

  keyEl.classList.add("pressed");
  playNote(info.freq);

  const keyRect = keyEl.getBoundingClientRect();
  const pianoRect = piano.getBoundingClientRect();
  const relX = keyRect.left - pianoRect.left + keyRect.width / 2;

  // Simple left/right split (first half keys â†’ left hand)
  if (keyOrder.indexOf(k) < keyOrder.length / 2) {
    moveHand(handL, relX);
  } else {
    moveHand(handR, relX);
  }
});

window.addEventListener("keyup", e => {
  const k = e.key.toLowerCase();
  const info = keyMap[k];
  if (!info) return;
  const keyEl = document.querySelector(`.key[data-note="${info.note}"]`);
  keyEl?.classList.remove("pressed");
});

// Touch/click support
piano.addEventListener("pointerdown", e => {
  e.preventDefault();
  const key = e.target.closest(".key");
  if (!key) return;
  const note = key.dataset.note;
  const info = NOTES.find(n => n.note === note);
  if (!info) return;

  key.classList.add("pressed");
  playNote(info.freq);

  const relX = e.clientX - piano.getBoundingClientRect().left;
  if (relX < piano.offsetWidth / 2) {
    moveHand(handL, relX);
  } else {
    moveHand(handR, relX);
  }
});

piano.addEventListener("pointerup pointercancel", e => {
  const key = e.target.closest(".key");
  key?.classList.remove("pressed");
});
</script>

</body>
</html>
