<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Dark Cartoon 3D Piano â€¢ QWERTZ + Full Keys</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: #0d0d0d;
    font-family: Arial, Helvetica, sans-serif;
    overflow: hidden;
    color: #ddd;
  }

  h1 {
    text-align: center;
    margin: 12px 0 4px;
    font-size: 2.2rem;
    text-shadow: 0 0 20px #6600aa, 0 0 40px #440088;
    letter-spacing: 1px;
  }

  .scene {
    perspective: 1300px;
    width: 100%;
    height: 84vh;
    position: relative;
    transform-style: preserve-3d;
  }

  .piano-container {
    position: absolute;
    top: 48%;
    left: 50%;
    transform: translate(-50%, -50%) rotateX(15deg) rotateY(2deg);
    transform-style: preserve-3d;
    width: 1100px;          /* wider for more keys */
    height: 360px;
  }

  .piano-body {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(#1a1a1a, #0a0a0a);
    border-radius: 32px;
    box-shadow: 
      0 40px 100px #000000ee,
      inset 0 12px 40px #222222,
      inset 0 -20px 50px #000000cc;
    border: 10px solid #222;
  }

  .keys-wrapper {
    position: absolute;
    bottom: 40px;
    left: 18px;
    right: 18px;
    height: 200px;
    display: flex;
    gap: 3px;
    transform: translateZ(22px);
  }

  .key {
    position: relative;
    flex: 1;
    background: #111;
    border: 1px solid #222;
    border-radius: 0 0 14px 14px;
    box-shadow: 
      inset 0 -10px 18px #000,
      0 14px 35px #00000088,
      0 6px 16px #00000055;
    transition: all 0.09s ease;
    cursor: pointer;
    user-select: none;
  }

  .key.white {
    background: linear-gradient(#222, #111);
  }

  .key.black {
    width: 42px;
    height: 124px;
    background: linear-gradient(#000, #111);
    margin: 0 -21px;
    z-index: 2;
    border-radius: 0 0 12px 12px;
    box-shadow: 
      inset 0 -8px 14px #000,
      0 18px 40px #000000bb,
      6px 0 16px #000 inset;
  }

  .key.pressed {
    transform: translateY(14px) translateZ(10px);
    box-shadow: 
      0 6px 18px #aa00ff66,
      inset 0 -6px 12px #6600aa44;
    background: linear-gradient(to bottom, #440066, #220033) !important;
  }

  .black.pressed {
    transform: translateY(10px) translateZ(12px);
    background: linear-gradient(#8800ff, #440088) !important;
    box-shadow: 0 8px 25px #aa44ffaa;
  }

  .hands {
    position: absolute;
    bottom: 160px;
    left: 50%;
    transform: translateX(-50%);
    width: 880px;           /* wider hands area */
    height: 260px;
    pointer-events: none;
    z-index: 10;
  }

  .hand {
    position: absolute;
    width: 220px;
    height: 260px;
    background: linear-gradient(135deg, #ffdbac, #ffb380);
    border-radius: 100px 100px 55px 55px;
    box-shadow: 
      0 25px 60px #00000099,
      inset 0 12px 35px #ffffff66;
    transform-origin: bottom center;
  }

  .hand.left  { left: -100px; transform: rotate(-18deg); }
  .hand.right { right: -100px; transform: rotate(18deg); }

  .fingers {
    position: absolute;
    bottom: 30px;
    left: 28px;
    right: 28px;
    display: flex;
    justify-content: space-between;
  }

  .finger {
    width: 30px;
    height: 105px;
    background: #ffe4ca;
    border-radius: 15px;
    box-shadow: inset 0 -12px 18px #00000044;
    position: relative;
    transform-origin: bottom center;
  }

  .finger::after {
    content: "";
    position: absolute;
    bottom: -14px;
    left: 7px;
    width: 16px;
    height: 16px;
    background: #ff7777;
    border-radius: 50%;
    box-shadow: 0 5px 12px #ff3333aa;
  }

  .hand.left  .finger { transform: rotate(12deg); }
  .hand.right .finger { transform: rotate(-12deg); }

  .finger.pressing {
    transform: rotate(28deg) translateY(14px) scaleY(0.82) !important;
    transition: all 0.11s ease;
  }

  .label {
    position: absolute;
    top: -34px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.95rem;
    color: #ddbbff;
    text-shadow: 0 0 14px #9966ff;
    pointer-events: none;
    opacity: 0.8;
  }

  .octave-label {
    position: absolute;
    top: -52px;
    font-size: 1.3rem;
    color: #bb88ff;
    text-shadow: 0 0 18px #7744ff;
  }
</style>
</head>
<body>

<h1>ðŸŒ‘ Dark Cartoon Piano â€“ More Keys + QWERTZ ðŸŒ‘</h1>

<div class="scene">
  <div class="piano-container">
    <div class="piano-body"></div>

    <div class="keys-wrapper" id="keys"></div>

    <div class="hands">
      <div class="hand left" id="handLeft">
        <div class="fingers">
          <div class="finger" data-finger="1"></div>
          <div class="finger" data-finger="2"></div>
          <div class="finger" data-finger="3"></div>
          <div class="finger" data-finger="4"></div>
          <div class="finger" data-finger="5"></div>
        </div>
      </div>
      <div class="hand right" id="handRight">
        <div class="fingers">
          <div class="finger" data-finger="1"></div>
          <div class="finger" data-finger="2"></div>
          <div class="finger" data-finger="3"></div>
          <div class="finger" data-finger="4"></div>
          <div class="finger" data-finger="5"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Note frequencies (A4 = 440 Hz)
const noteFreq = {
  "C3":  130.81, "C#3": 138.59, "D3":  146.83, "D#3": 155.56,
  "E3":  164.81, "F3":  174.61, "F#3": 185.00, "G3":  196.00,
  "G#3": 207.65, "A3":  220.00, "A#3": 233.08, "B3":  246.94,
  "C4":  261.63, "C#4": 277.18, "D4":  293.66, "D#4": 311.13,
  "E4":  329.63, "F4":  349.23, "F#4": 369.99, "G4":  392.00,
  "G#4": 415.30, "A4":  440.00, "A#4": 466.16, "B4":  493.88,
  "C5":  523.25, "C#5": 554.37, "D5":  587.33, "D#5": 622.25,
  "E5":  659.25, "F5":  698.46, "F#5": 739.99, "G5":  783.99,
  "G#5": 830.61, "A5":  880.00, "A#5": 932.33, "B5":  987.77,
  "C6": 1046.50
};

const NOTES = [
  // Lower octave (C3â€“B3) â€“ mostly numbers + some letters
  {note:"C3",  key:"1", isBlack:false},
  {note:"C#3", key:"!", isBlack:true},
  {note:"D3",  key:"2", isBlack:false},
  {note:"D#3", key:"\"",isBlack:true},
  {note:"E3",  key:"3", isBlack:false},
  {note:"F3",  key:"4", isBlack:false},
  {note:"F#3", key:"$", isBlack:true},
  {note:"G3",  key:"5", isBlack:false},
  {note:"G#3", key:"%", isBlack:true},
  {note:"A3",  key:"6", isBlack:false},
  {note:"A#3", key:"&", isBlack:true},
  {note:"B3",  key:"7", isBlack:false},

  // Main octave C4â€“B4 (qwertz style â€“ z is now where y was in qwerty)
  {note:"C4",  key:"y", isBlack:false},   // y = C (common in some virtual pianos)
  {note:"C#4", key:"s", isBlack:true},
  {note:"D4",  key:"x", isBlack:false},
  {note:"D#4", key:"d", isBlack:true},
  {note:"E4",  key:"c", isBlack:false},
  {note:"F4",  key:"v", isBlack:false},
  {note:"F#4", key:"g", isBlack:true},
  {note:"G4",  key:"b", isBlack:false},
  {note:"G#4", key:"h", isBlack:true},
  {note:"A4",  key:"n", isBlack:false},
  {note:"A#4", key:"j", isBlack:true},
  {note:"B4",  key:"m", isBlack:false},

  // Higher octave C5â€“C6
  {note:"C5",  key:"q", isBlack:false},
  {note:"C#5", key:"2", isBlack:true},   // reuse some numbers with shift if needed, but here direct
  {note:"D5",  key:"w", isBlack:false},
  {note:"D#5", key:"3", isBlack:true},
  {note:"E5",  key:"e", isBlack:false},
  {note:"F5",  key:"r", isBlack:false},
  {note:"F#5", key:"5", isBlack:true},
  {note:"G5",  key:"t", isBlack:false},
  {note:"G#5", key:"6", isBlack:true},
  {note:"A5",  key:"z", isBlack:false},   // z moved here (qwertz has z left)
  {note:"A#5", key:"7", isBlack:true},
  {note:"B5",  key:"u", isBlack:false},
  {note:"C6",  key:"i", isBlack:false},
];

const keyMap = {};
NOTES.forEach(n => {
  keyMap[n.key.toLowerCase()] = n;
  // Also support uppercase / shift versions for some black keys if user presses shift
  if (n.isBlack) {
    const upper = n.key.toUpperCase();
    if (upper !== n.key) keyMap[upper] = n;
  }
});

const piano = document.getElementById("keys");
const handL = document.getElementById("handLeft");
const handR = document.getElementById("handRight");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

NOTES.forEach((item) => {
  const k = document.createElement("div");
  k.className = "key " + (item.isBlack ? "black" : "white");
  k.dataset.note = item.note;

  if (!item.isBlack) {
    const lbl = document.createElement("div");
    lbl.className = "label";
    lbl.textContent = item.note;
    k.appendChild(lbl);

    if (item.note === "C4" || item.note === "C5" || item.note === "C3") {
      const oct = document.createElement("div");
      oct.className = "octave-label";
      oct.textContent = item.note;
      k.appendChild(oct);
    }
  }

  piano.appendChild(k);
});

function playNote(note) {
  if (!noteFreq[note]) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = "sawtooth";
  osc.frequency.value = noteFreq[note];
  gain.gain.setValueAtTime(0.0, audioCtx.currentTime);
  gain.gain.linearRampToValueAtTime(0.42, audioCtx.currentTime + 0.008);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.4);
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + 1.5);
}

function pressFinger(hand, relX, fingerIndex = Math.floor(Math.random()*4)+1) {
  const current = parseFloat(hand.style.left || "0");
  const target = relX - 550; // center of wider piano
  hand.style.transition = "left 0.17s ease-out, transform 0.13s";
  hand.style.left = (current + (target - current) * 0.68) + "px";
  hand.style.transform = `rotate(${18 + (target - current)*0.11}deg) scale(1.07, 0.93)`;
  setTimeout(() => {
    hand.style.transform = `rotate(${18 + (target - current)*0.05}deg) scale(1,1)`;
  }, 130);

  const fingers = hand.querySelectorAll(".finger");
  fingers.forEach(f => f.classList.remove("pressing"));
  if (fingerIndex >= 0 && fingerIndex < fingers.length) {
    fingers[fingerIndex-1].classList.add("pressing");
    setTimeout(() => fingers[fingerIndex-1].classList.remove("pressing"), 200);
  }
}

window.addEventListener("keydown", e => {
  if (e.repeat) return;
  const k = e.key.toLowerCase();
  const info = keyMap[k];
  if (!info) return;

  const keyEl = document.querySelector(`.key[data-note="${info.note}"]`);
  if (!keyEl) return;

  keyEl.classList.add("pressed");
  playNote(info.note);

  const keyRect = keyEl.getBoundingClientRect();
  const pianoRect = piano.getBoundingClientRect();
  const relX = keyRect.left - pianoRect.left + keyRect.width / 2;

  // Rough left/right hand split (you can refine later)
  if (["1","2","3","4","5","6","7","y","x","c","v","b","n","m","s","d","g","h","j"].includes(k)) {
    pressFinger(handL, relX, Math.floor(Math.random()*3)+2);
  } else {
    pressFinger(handR, relX, Math.floor(Math.random()*3)+1);
  }
});

window.addEventListener("keyup", e => {
  const k = e.key.toLowerCase();
  const info = keyMap[k];
  if (!info) return;
  const keyEl = document.querySelector(`.key[data-note="${info.note}"]`);
  keyEl?.classList.remove("pressed");
});

// Touch support
piano.addEventListener("pointerdown", e => {
  e.preventDefault();
  const key = e.target.closest(".key");
  if (!key) return;
  const note = key.dataset.note;
  const info = NOTES.find(n => n.note === note);
  if (!info) return;

  key.classList.add("pressed");
  playNote(note);

  const relX = e.clientX - piano.getBoundingClientRect().left;
  if (relX < piano.offsetWidth / 2) {
    pressFinger(handL, relX);
  } else {
    pressFinger(handR, relX);
  }
});

piano.addEventListener("pointerup pointercancel", e => {
  const key = e.target.closest(".key");
  key?.classList.remove("pressed");
});
</script>

</body>
</html>
