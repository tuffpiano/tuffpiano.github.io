<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Dark Cartoon 3D Piano â€¢ Play Me!</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: #0d0d0d; /* very dark grey */
    font-family: Arial, Helvetica, sans-serif;
    overflow: hidden;
    color: #ddd;
  }

  h1 {
    text-align: center;
    margin: 15px 0 5px;
    font-size: 2.4rem;
    text-shadow: 0 0 20px #6600aa, 0 0 40px #440088;
    letter-spacing: 2px;
  }

  .scene {
    perspective: 1300px;
    width: 100%;
    height: 82vh;
    position: relative;
    transform-style: preserve-3d;
  }

  .piano-container {
    position: absolute;
    top: 48%;
    left: 50%;
    transform: translate(-50%, -50%) rotateX(15deg) rotateY(2deg);
    transform-style: preserve-3d;
    width: 880px;
    height: 360px;
  }

  .piano-body {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(#1a1a1a, #0a0a0a);
    border-radius: 28px;
    box-shadow: 
      0 40px 100px #000000ee,
      inset 0 12px 40px #222222,
      inset 0 -20px 50px #000000cc;
    border: 10px solid #222;
  }

  .keys-wrapper {
    position: absolute;
    bottom: 40px;
    left: 22px;
    right: 22px;
    height: 200px;
    display: flex;
    gap: 3px;
    transform: translateZ(22px);
  }

  .key {
    position: relative;
    flex: 1;
    background: #111;
    border: 1px solid #222;
    border-radius: 0 0 14px 14px;
    box-shadow: 
      inset 0 -10px 18px #000,
      0 14px 35px #00000088,
      0 6px 16px #00000055;
    transition: all 0.09s ease;
    cursor: pointer;
    user-select: none;
  }

  .key.white {
    background: linear-gradient(#222, #111);
  }

  .key.black {
    width: 42px;
    height: 124px;
    background: linear-gradient(#000, #111);
    margin: 0 -21px;
    z-index: 2;
    border-radius: 0 0 12px 12px;
    box-shadow: 
      inset 0 -8px 14px #000,
      0 18px 40px #000000bb,
      6px 0 16px #000 inset;
  }

  .key.pressed {
    transform: translateY(14px) translateZ(10px);
    box-shadow: 
      0 6px 18px #aa00ff66,
      inset 0 -6px 12px #6600aa44;
    background: linear-gradient(to bottom, #440066, #220033) !important;
  }

  .black.pressed {
    transform: translateY(10px) translateZ(12px);
    background: linear-gradient(#8800ff, #440088) !important;
    box-shadow: 0 8px 25px #aa44ffaa;
  }

  /* Hands â€“ now ABOVE keys */
  .hands {
    position: absolute;
    bottom: 160px;          /* raised above keys */
    left: 50%;
    transform: translateX(-50%);
    width: 720px;
    height: 260px;
    pointer-events: none;
    z-index: 10;
  }

  .hand {
    position: absolute;
    width: 200px;
    height: 260px;
    background: linear-gradient(135deg, #ffdbac, #ffb380);
    border-radius: 90px 90px 50px 50px;
    box-shadow: 
      0 25px 60px #00000099,
      inset 0 12px 35px #ffffff66;
    transform-origin: bottom center;
  }

  .hand.left  { left: -80px; transform: rotate(-15deg); }
  .hand.right { right: -80px; transform: rotate(15deg); }

  .fingers {
    position: absolute;
    bottom: 30px;
    left: 25px;
    right: 25px;
    display: flex;
    justify-content: space-between;
  }

  .finger {
    width: 28px;
    height: 100px;
    background: #ffe4ca;
    border-radius: 14px;
    box-shadow: inset 0 -12px 18px #00000044;
    position: relative;
    transform-origin: bottom center;
  }

  .finger::after {
    content: "";
    position: absolute;
    bottom: -14px;
    left: 6px;
    width: 16px;
    height: 16px;
    background: #ff7777;
    border-radius: 50%;
    box-shadow: 0 5px 12px #ff3333aa;
  }

  .hand.left  .finger { transform: rotate(10deg); }
  .hand.right .finger { transform: rotate(-10deg); }

  /* Finger press animation */
  .finger.pressing {
    transform: rotate(25deg) translateY(12px) scaleY(0.85);
    transition: all 0.12s ease;
  }

  .label {
    position: absolute;
    top: -32px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.1rem;
    color: #ddbbff;
    text-shadow: 0 0 14px #9966ff;
    pointer-events: none;
    opacity: 0.85;
  }

  .octave-label {
    position: absolute;
    top: -50px;
    font-size: 1.4rem;
    color: #bb88ff;
    text-shadow: 0 0 18px #7744ff;
  }
</style>
</head>
<body>

<h1>ðŸŒ‘ Dark Cartoon Piano ðŸŒ‘</h1>

<div class="scene">
  <div class="piano-container">
    <div class="piano-body"></div>

    <div class="keys-wrapper" id="keys"></div>

    <div class="hands">
      <div class="hand left"  id="handLeft">
        <div class="fingers">
          <div class="finger" data-finger="1"></div>
          <div class="finger" data-finger="2"></div>
          <div class="finger" data-finger="3"></div>
          <div class="finger" data-finger="4"></div>
          <div class="finger" data-finger="5"></div>
        </div>
      </div>
      <div class="hand right" id="handRight">
        <div class="fingers">
          <div class="finger" data-finger="1"></div>
          <div class="finger" data-finger="2"></div>
          <div class="finger" data-finger="3"></div>
          <div class="finger" data-finger="4"></div>
          <div class="finger" data-finger="5"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Note frequencies (A4 = 440 Hz)
const noteFreq = {
  "C4":  261.63, "C#4": 277.18, "D4":  293.66, "D#4": 311.13,
  "E4":  329.63, "F4":  349.23, "F#4": 369.99, "G4":  392.00,
  "G#4": 415.30, "A4":  440.00, "A#4": 466.16, "B4":  493.88,
  "C5":  523.25, "C#5": 554.37, "D5":  587.33, "D#5": 622.25,
  "E5":  659.25, "F5":  698.46, "F#5": 739.99, "G5":  783.99,
  "G#5": 830.61, "A5":  880.00, "A#5": 932.33, "B5":  987.77
};

const NOTES = [
  {note:"C4",  key:"z", isBlack:false, offset:0},
  {note:"C#4", key:"s", isBlack:true,  offset:1},
  {note:"D4",  key:"x", isBlack:false, offset:2},
  {note:"D#4", key:"d", isBlack:true,  offset:3},
  {note:"E4",  key:"c", isBlack:false, offset:4},
  {note:"F4",  key:"v", isBlack:false, offset:5},
  {note:"F#4", key:"g", isBlack:true,  offset:6},
  {note:"G4",  key:"b", isBlack:false, offset:7},
  {note:"G#4", key:"h", isBlack:true,  offset:8},
  {note:"A4",  key:"n", isBlack:false, offset:9},
  {note:"A#4", key:"j", isBlack:true,  offset:10},
  {note:"B4",  key:"m", isBlack:false, offset:11},
  {note:"C5",  key:"q", isBlack:false, offset:12},
  {note:"C#5", key:"2", isBlack:true,  offset:13},
  {note:"D5",  key:"w", isBlack:false, offset:14},
  {note:"D#5", key:"3", isBlack:true,  offset:15},
  {note:"E5",  key:"e", isBlack:false, offset:16},
  {note:"F5",  key:"r", isBlack:false, offset:17},
  {note:"F#5", key:"5", isBlack:true,  offset:18},
  {note:"G5",  key:"t", isBlack:false, offset:19},
  {note:"G#5", key:"6", isBlack:true,  offset:20},
  {note:"A5",  key:"y", isBlack:false, offset:21},
  {note:"A#5", key:"7", isBlack:true,  offset:22},
  {note:"B5",  key:"u", isBlack:false, offset:23},
];

const keyMap = {};
NOTES.forEach(n => keyMap[n.key] = n);

const piano = document.getElementById("keys");
const handL = document.getElementById("handLeft");
const handR = document.getElementById("handRight");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

// Create visual keys (black piano style)
NOTES.forEach((item, i) => {
  const k = document.createElement("div");
  k.className = "key " + (item.isBlack ? "black" : "white");
  k.dataset.note = item.note;
  k.dataset.index = i;

  if (!item.isBlack) {
    const lbl = document.createElement("div");
    lbl.className = "label";
    lbl.textContent = item.note;
    k.appendChild(lbl);

    if (item.note === "C4" || item.note === "C5") {
      const oct = document.createElement("div");
      oct.className = "octave-label";
      oct.textContent = item.note;
      k.appendChild(oct);
    }
  }

  piano.appendChild(k);
});

// Play note with Web Audio (simple sawtooth + gain envelope)
function playNote(note) {
  if (!noteFreq[note]) return;

  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "sawtooth";          // bright piano-ish
  osc.frequency.value = noteFreq[note];

  gain.gain.setValueAtTime(0.0, audioCtx.currentTime);
  gain.gain.linearRampToValueAtTime(0.4, audioCtx.currentTime + 0.01);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.2);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 1.3);
}

// Move hand + press a finger (cartoon style)
function pressFinger(hand, relX, fingerIndex = 2) {   // middle finger default
  const current = parseFloat(hand.style.left || "0");
  const target = relX - 360;   // center adjustment
  hand.style.transition = "left 0.16s ease-out, transform 0.12s";
  hand.style.left = (current + (target - current) * 0.7) + "px";

  hand.style.transform = `rotate(${15 + (target - current)*0.12}deg) scale(1.06, 0.94)`;

  setTimeout(() => {
    hand.style.transform = `rotate(${15 + (target - current)*0.06}deg) scale(1,1)`;
  }, 120);

  // Press one finger
  const fingers = hand.querySelectorAll(".finger");
  fingers.forEach(f => f.classList.remove("pressing"));
  if (fingerIndex >= 0 && fingerIndex < fingers.length) {
    fingers[fingerIndex].classList.add("pressing");
    setTimeout(() => fingers[fingerIndex].classList.remove("pressing"), 180);
  }
}

window.addEventListener("keydown", e => {
  if (e.repeat) return;
  const k = e.key.toLowerCase();
  if (!keyMap[k]) return;

  const info = keyMap[k];
  const keyEl = document.querySelector(`.key[data-note="${info.note}"]`);
  if (!keyEl) return;

  keyEl.classList.add("pressed");
  playNote(info.note);

  const keyRect = keyEl.getBoundingClientRect();
  const pianoRect = piano.getBoundingClientRect();
  const relX = keyRect.left - pianoRect.left + keyRect.width / 2;

  if (["z","s","x","d","c","v","g","b","h","n","j","m"].includes(k)) {
    pressFinger(handL, relX, Math.floor(Math.random()*3)+1); // random-ish finger 1-4
  } else {
    pressFinger(handR, relX, Math.floor(Math.random()*3)+1);
  }
});

window.addEventListener("keyup", e => {
  const k = e.key.toLowerCase();
  if (!keyMap[k]) return;
  const info = keyMap[k];
  const keyEl = document.querySelector(`.key[data-note="${info.note}"]`);
  keyEl?.classList.remove("pressed");
});

// Basic touch/click support
piano.addEventListener("pointerdown", e => {
  e.preventDefault();
  const key = e.target.closest(".key");
  if (!key) return;

  const note = key.dataset.note;
  const info = NOTES.find(n => n.note === note);
  if (!info) return;

  key.classList.add("pressed");
  playNote(note);

  const relX = e.clientX - piano.getBoundingClientRect().left;
  if (relX < piano.offsetWidth / 2) {
    pressFinger(handL, relX);
  } else {
    pressFinger(handR, relX);
  }
});

piano.addEventListener("pointerup pointercancel", e => {
  const key = e.target.closest(".key");
  key?.classList.remove("pressed");
});
</script>

</body>
</html>
