<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rush E Piano</title>

<style>
body {
  margin: 0;
  background: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.piano {
  position: relative;
  display: flex;
  padding: 20px;
  background: #111;
  border-radius: 12px;
}

.key {
  position: relative;
  cursor: pointer;
  user-select: none;
}

.white {
  width: 48px;
  height: 260px;
  background: linear-gradient(#fff, #ddd);
  border: 1px solid #aaa;
}

.white.active {
  background: #bbb;
  transform: translateY(4px);
}

.black {
  width: 30px;
  height: 160px;
  background: linear-gradient(#000, #333);
  position: absolute;
  top: 0;
  right: -15px;
  z-index: 5;
}

.black.active {
  background: #555;
  transform: translateY(3px);
}
</style>
</head>

<body>

<div class="piano" id="piano"></div>

<script>
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

/* ---------- PIANO SOUND ---------- */
function playPiano(freq) {
  const now = audioCtx.currentTime;
  const out = audioCtx.createGain();
  out.gain.setValueAtTime(0.6, now);
  out.gain.exponentialRampToValueAtTime(0.001, now + 2.5);
  out.connect(audioCtx.destination);

  [1,2,3].forEach((m,i)=>{
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = "triangle";
    osc.frequency.value = freq * m;
    g.gain.setValueAtTime(0.5/(i+1), now);
    g.gain.exponentialRampToValueAtTime(0.001, now + 2);
    osc.connect(g);
    g.connect(out);
    osc.start();
    osc.stop(now + 3);
  });
}

/* ---------- NOTES ---------- */
const notes = [
  "C3","D3","E3","F3","G3","A3","B3",
  "C4","D4","E4","F4","G4","A4","B4",
  "C5","D5","E5","F5","G5","A5","B5"
];

const freq = {
  C3:130.81,D3:146.83,E3:164.81,F3:174.61,G3:196,A3:220,B3:246.94,
  C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440,B4:493.88,
  C5:523.25,D5:587.33,E5:659.25,F5:698.46,G5:783.99,A5:880,B5:987.77
};

/* ---------- RUSH E (SIMPLIFIED GUIDED) ---------- */
const rushE = [
  "E4","F4","G4","A4","B4","C5","D5","E5",
  "D5","C5","B4","A4","G4","F4","E4",
  "E5","G5","E5","D5","C5","B4","A4"
];

let cheat = false;
let idx = 0;

const piano = document.getElementById("piano");
const keyMap = {};

notes.forEach(note => {
  const k = document.createElement("div");
  k.className = "key white";
  k.onclick = () => press(note);
  piano.appendChild(k);
  keyMap[note] = k;
});

/* ---------- INPUT ---------- */
function press(note) {
  const n = cheat ? rushE[idx++] : note;
  if (idx >= rushE.length) idx = 0;
  playPiano(freq[n]);
  const k = keyMap[n];
  k.classList.add("active");
  setTimeout(()=>k.classList.remove("active"),120);
}

document.addEventListener("keydown", e => {
  if (e.key === "0") cheat = !cheat;
});
</script>

</body>
</html>
