<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Piano â€“ Moonlight Sonata Mode</title>
<style>
  body {
    background:#111;
    color:white;
    font-family:Arial, sans-serif;
    text-align:center;
  }
  h1 { margin-bottom:5px; }
  #mode { margin-bottom:20px; color:#0f0; }

  .piano {
    display:flex;
    justify-content:center;
    flex-wrap:wrap;
    gap:4px;
  }

  .key {
    width:40px;
    height:160px;
    background:white;
    border-radius:4px;
    color:black;
    display:flex;
    align-items:flex-end;
    justify-content:center;
    padding-bottom:5px;
    font-size:12px;
    user-select:none;
  }

  .key.active {
    background:#ffcc00;
  }
</style>
</head>
<body>

<h1>Keyboard Piano</h1>
<div id="mode">Mode: NORMAL</div>

<div class="piano" id="piano"></div>

<script>
/* =======================
   KEYBOARD LAYOUT
======================= */
const keyboardKeys =
"1234567890qwertzuiopasdfghjklyxcvbnm".split("");

/* Simple ascending note set */
const notes = [
  261.63, 277.18, 293.66, 311.13, 329.63,
  349.23, 369.99, 392.00, 415.30, 440.00,
  466.16, 493.88, 523.25, 554.37, 587.33,
  622.25, 659.25, 698.46, 739.99, 783.99,
  830.61, 880.00, 932.33, 987.77,
  1046.50, 1108.73, 1174.66, 1244.51,
  1318.51, 1396.91, 1479.98, 1567.98,
  1661.22, 1760.00, 1864.66, 1975.53
];

const keyMap = {};
keyboardKeys.forEach((k,i)=>{
  keyMap[k] = notes[i % notes.length];
});

/* =======================
   MOONLIGHT 3RD (GUIDED)
   simplified correct notes
======================= */
const moonlight3 = [
  659.25, 784.00, 987.77, 784.00,
  659.25, 784.00, 987.77, 784.00,
  622.25, 739.99, 932.33, 739.99,
  587.33, 698.46, 880.00, 698.46
];

let moonIndex = 0;
let guidedMode = false;

/* =======================
   AUDIO
======================= */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playNote(freq) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.frequency.value = freq;
  osc.type = "sine";

  gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.8);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.8);
}

/* =======================
   VISUAL PIANO
======================= */
const piano = document.getElementById("piano");

keyboardKeys.forEach(k=>{
  const div = document.createElement("div");
  div.className = "key";
  div.textContent = k;
  div.dataset.key = k;
  piano.appendChild(div);
});

function highlight(k) {
  const el = document.querySelector(`[data-key="${k}"]`);
  if(!el) return;
  el.classList.add("active");
  setTimeout(()=>el.classList.remove("active"),150);
}

/* =======================
   KEYBOARD INPUT
======================= */
document.addEventListener("keydown", e => {
  if (e.code === "Insert") {
    guidedMode = !guidedMode;
    moonIndex = 0;
    document.getElementById("mode").textContent =
      "Mode: " + (guidedMode ? "MOONLIGHT SONATA 3rd (GUIDED)" : "NORMAL");
    return;
  }

  const key = e.key.toLowerCase();
  if (!keyMap[key]) return;

  highlight(key);

  if (guidedMode) {
    playNote(moonlight3[moonIndex]);
    moonIndex = (moonIndex + 1) % moonlight3.length;
  } else {
    playNote(keyMap[key]);
  }
});
</script>

</body>
</html>
