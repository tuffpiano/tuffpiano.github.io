<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Piano â€“ Moonlight Sonata Mode</title>

<style>
body{
  margin:0;
  background:radial-gradient(circle at top,#222,#000);
  color:#fff;
  font-family:Segoe UI,Arial,sans-serif;
  text-align:center;
}

h1{
  margin:20px 0 5px;
  font-weight:300;
  letter-spacing:2px;
}

#mode{
  margin-bottom:20px;
  color:#00ff88;
  font-size:14px;
}

/* Piano container */
.piano{
  position:relative;
  width:1080px;
  height:260px;
  margin:40px auto;
  perspective:1000px;
}

/* White keys */
.white-key{
  position:relative;
  width:45px;
  height:240px;
  background:linear-gradient(to bottom,#fff,#ddd);
  border-radius:0 0 6px 6px;
  box-shadow:
    inset 0 -4px 6px rgba(0,0,0,.3),
    0 8px 15px rgba(0,0,0,.6);
  display:inline-flex;
  justify-content:center;
  align-items:flex-end;
  font-size:12px;
  color:#000;
  user-select:none;
}

.white-key.active{
  background:linear-gradient(to bottom,#ffe066,#ffb703);
}

/* Black keys */
.black-key{
  position:absolute;
  width:28px;
  height:150px;
  background:linear-gradient(to bottom,#111,#000);
  border-radius:0 0 4px 4px;
  box-shadow:
    inset 0 -4px 6px rgba(255,255,255,.1),
    0 6px 10px rgba(0,0,0,.8);
  z-index:10;
}

.black-key.active{
  background:linear-gradient(to bottom,#ffb703,#cc8f00);
}

.key-label{
  margin-bottom:8px;
  opacity:.6;
}
</style>
</head>

<body>

<h1>KEYBOARD PIANO</h1>
<div id="mode">Mode: NORMAL (press # for Moonlight Sonata 3rd)</div>

<div class="piano" id="piano"></div>

<script>
/* =======================
   KEYBOARD LAYOUT
======================= */
const keyboard =
"1234567890qwertzuiopasdfghjklyxcvbnm".split("");

/* Notes (C4 upward) */
const frequencies = [
  261.63,277.18,293.66,311.13,329.63,
  349.23,369.99,392.00,415.30,440.00,
  466.16,493.88,523.25,554.37,587.33,
  622.25,659.25,698.46,739.99,783.99,
  830.61,880.00,932.33,987.77,
  1046.50,1108.73,1174.66,1244.51,
  1318.51,1396.91,1479.98,1567.98,
  1661.22,1760.00,1864.66,1975.53
];

const keyMap = {};
keyboard.forEach((k,i)=>keyMap[k]=frequencies[i]);

/* =======================
   MOONLIGHT SONATA 3rd
   (guided sequence sample)
======================= */
const moonlight = [
  659.25,784.00,987.77,784.00,
  659.25,784.00,987.77,784.00,
  622.25,739.99,932.33,739.99,
  587.33,698.46,880.00,698.46
];

let moonIndex = 0;
let guided = false;

/* =======================
   AUDIO
======================= */
const audio = new (window.AudioContext || window.webkitAudioContext)();

function play(freq){
  const o = audio.createOscillator();
  const g = audio.createGain();

  o.type="triangle";
  o.frequency.value=freq;

  g.gain.setValueAtTime(0.25,audio.currentTime);
  g.gain.exponentialRampToValueAtTime(
    0.001,audio.currentTime+1
  );

  o.connect(g);
  g.connect(audio.destination);
  o.start();
  o.stop(audio.currentTime+1);
}

/* =======================
   BUILD PIANO
======================= */
const piano = document.getElementById("piano");

const whiteKeys = [];
keyboard.forEach((k,i)=>{
  const wk = document.createElement("div");
  wk.className="white-key";
  wk.dataset.key=k;
  wk.innerHTML=`<div class="key-label">${k}</div>`;
  piano.appendChild(wk);
  whiteKeys.push(wk);

  /* black keys placement */
  const mod = i % 12;
  if([1,3,6,8,10].includes(mod)){
    const bk = document.createElement("div");
    bk.className="black-key";
    bk.style.left = (i*45 - 14) + "px";
    piano.appendChild(bk);
  }
});

/* =======================
   VISUAL PRESS
======================= */
function flash(key){
  const el = document.querySelector(`[data-key="${key}"]`);
  if(!el) return;
  el.classList.add("active");
  setTimeout(()=>el.classList.remove("active"),150);
}

/* =======================
   KEYBOARD INPUT
======================= */
document.addEventListener("keydown",e=>{
  if(e.key==="#"){
    guided=!guided;
    moonIndex=0;
    document.getElementById("mode").textContent =
      guided
      ? "Mode: MOONLIGHT SONATA 3rd (GUIDED)"
      : "Mode: NORMAL (press # for Moonlight Sonata 3rd)";
    return;
  }

  const k = e.key.toLowerCase();
  if(!keyMap[k]) return;

  flash(k);

  if(guided){
    play(moonlight[moonIndex]);
    moonIndex = (moonIndex+1)%moonlight.length;
  } else {
    play(keyMap[k]);
  }
});
</script>

</body>
</html>
