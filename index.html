<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Moonlight Sonata Cheat Piano</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #222, #000);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  font-family: Arial, sans-serif;
}

.piano {
  position: relative;
  display: flex;
  padding: 20px;
  background: #111;
  border-radius: 14px;
  box-shadow: 0 30px 60px rgba(0,0,0,0.8);
}

.key {
  position: relative;
  cursor: pointer;
  user-select: none;
}

.white {
  width: 52px;
  height: 260px;
  background: linear-gradient(#fff, #ddd);
  border: 1px solid #aaa;
  border-radius: 0 0 6px 6px;
  box-shadow: inset 0 -4px 4px rgba(0,0,0,0.2);
}

.white.active {
  background: linear-gradient(#ddd, #bbb);
  transform: translateY(4px);
}

.black {
  width: 32px;
  height: 160px;
  background: linear-gradient(#111, #000);
  position: absolute;
  top: 0;
  right: -16px;
  z-index: 5;
  border-radius: 0 0 5px 5px;
  box-shadow: inset 0 -4px 6px rgba(255,255,255,0.1);
}

.black.active {
  background: #333;
  transform: translateY(3px);
}

.info {
  position: absolute;
  top: -40px;
  width: 100%;
  text-align: center;
  color: #aaa;
  font-size: 14px;
}
</style>
</head>

<body>

<div class="piano" id="piano">
  <div class="info">Press 0 to toggle Cheat Mode (Moonlight Sonata)</div>
</div>

<script>
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

function playPiano(freq) {
  const now = audioCtx.currentTime;
  const output = audioCtx.createGain();
  output.gain.setValueAtTime(0.7, now);
  output.gain.exponentialRampToValueAtTime(0.001, now + 3);
  output.connect(audioCtx.destination);

  const harmonics = [
    { m: 1, g: 1 },
    { m: 2, g: 0.4 },
    { m: 3, g: 0.25 },
    { m: 4, g: 0.1 }
  ];

  harmonics.forEach(h => {
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();

    osc.type = "triangle";
    osc.frequency.value = freq * h.m;

    g.gain.setValueAtTime(h.g, now);
    g.gain.exponentialRampToValueAtTime(0.001, now + 2.5);

    osc.connect(g);
    g.connect(output);

    osc.start(now);
    osc.stop(now + 3);
  });
}

const noteFreq = {
  "G#3":207.65,"A3":220,"B3":246.94,
  "C#4":277.18,"D#4":311.13,"E4":329.63,"F#4":369.99,
  "G#4":415.3,"A4":440
};

const moonlight = [
  "G#3","C#4","E4",
  "G#3","C#4","E4",
  "G#3","C#4","E4",
  "A3","C#4","E4",
  "B3","D#4","F#4",
  "G#3","C#4","E4"
];

let cheatMode = false;
let moonIndex = 0;

const piano = document.getElementById("piano");
const keysByNote = {};

function createWhite(note) {
  const key = document.createElement("div");
  key.className = "key white";
  key.onclick = () => keyPress(note);
  piano.appendChild(key);
  keysByNote[note] = key;
}

function createBlack(note) {
  const key = document.createElement("div");
  key.className = "key black";
  key.onclick = () => keyPress(note);
  keysByNote[note] = key;
  return key;
}

["G#3","A3","B3","C#4","D#4","E4","F#4","G#4","A4"].forEach(note => {
  createWhite(note);
});

[
  { note:"G#3", pos:0 },
  { note:"C#4", pos:3 },
  { note:"D#4", pos:4 },
  { note:"F#4", pos:6 },
  { note:"G#4", pos:7 }
].forEach(b => {
  const key = createBlack(b.note);
  piano.children[b.pos + 1].appendChild(key);
});

function keyPress(clickedNote) {
  if (!cheatMode) {
    trigger(clickedNote);
  } else {
    const correct = moonlight[moonIndex];
    trigger(correct);
    moonIndex = (moonIndex + 1) % moonlight.length;
  }
}

function trigger(note) {
  playPiano(noteFreq[note]);
  const key = keysByNote[note];
  key.classList.add("active");
  setTimeout(() => key.classList.remove("active"), 150);
}

document.addEventListener("keydown", e => {
  if (e.key === "0") {
    cheatMode = !cheatMode;
    moonIndex = 0;
    alert("Cheat mode: " + (cheatMode ? "ON" : "OFF"));
  }
});
</script>

</body>
</html>
